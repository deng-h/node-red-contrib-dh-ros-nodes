# ZJ Humanoid ROS Nodes - ä½¿ç”¨æŒ‡å—

## ğŸ“– é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªä¸º ZJ Humanoid æœºå™¨äººè‡ªåŠ¨ç”Ÿæˆçš„ Node-RED ROS èŠ‚ç‚¹åŒ…ã€‚é€šè¿‡è¯»å– `zj_humanoid_interfaces.json` é…ç½®æ–‡ä»¶,è‡ªåŠ¨ç”Ÿæˆäº† **170 ä¸ªèŠ‚ç‚¹**,åŒ…æ‹¬:

- **88 ä¸ªæœåŠ¡èŠ‚ç‚¹** - ç”¨äºè°ƒç”¨ ROS æœåŠ¡
- **55 ä¸ªè¯é¢˜å‘å¸ƒèŠ‚ç‚¹** - ç”¨äºå‘å¸ƒ ROS æ¶ˆæ¯
- **27 ä¸ªè¯é¢˜è®¢é˜…èŠ‚ç‚¹** - ç”¨äºè®¢é˜… ROS æ¶ˆæ¯

æ‰€æœ‰èŠ‚ç‚¹éƒ½é¢„è®¾äº†æœåŠ¡/è¯é¢˜åç§°å’Œæ¶ˆæ¯ç±»å‹,**æ— éœ€æ‰‹åŠ¨å¡«å†™**,å¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç”ŸæˆèŠ‚ç‚¹

åœ¨ `my_nodes` ç›®å½•ä¸‹è¿è¡Œç”Ÿæˆå™¨:

```bash
cd my_nodes
node generator.js
```

ç”Ÿæˆçš„æ–‡ä»¶ä½äº `my_nodes/generated/` ç›®å½•ã€‚

### 2. å®‰è£…åˆ° Node-RED

#### æ–¹æ³•ä¸€: æœ¬åœ°å®‰è£… (æ¨è)

```bash
cd ~/.node-red
npm install /path/to/my_nodes/generated
```

Windows ç”¨æˆ·:
```powershell
cd $env:USERPROFILE\.node-red
npm install d:\myCode\node-red-ros-nodes\my_nodes\generated
```

#### æ–¹æ³•äºŒ: åˆ›å»ºç¬¦å·é“¾æ¥

```bash
cd ~/.node-red/node_modules
ln -s /path/to/my_nodes/generated node-red-contrib-zj-humanoid-nodes
```

### 3. é‡å¯ Node-RED

```bash
node-red-stop
node-red-start
```

æˆ–è€…åœ¨ Node-RED ç•Œé¢å³ä¸Šè§’é€‰æ‹© "é‡æ–°éƒ¨ç½²" â†’ "å®Œå…¨éƒ¨ç½²"ã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
my_nodes/
â”œâ”€â”€ README.md                          # æœ¬æ–‡ä»¶
â”œâ”€â”€ USAGE.md                           # ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ zj_humanoid_interfaces.json        # èŠ‚ç‚¹å®šä¹‰é…ç½®
â”œâ”€â”€ generator.js                       # è‡ªåŠ¨ç”Ÿæˆå™¨è„šæœ¬
â”œâ”€â”€ package.json                       # ç”Ÿæˆå™¨åŒ…é…ç½®
â”‚
â”œâ”€â”€ templates/                         # èŠ‚ç‚¹æ¨¡æ¿
â”‚   â”œâ”€â”€ service-call.js.template      # æœåŠ¡è°ƒç”¨ JS æ¨¡æ¿
â”‚   â”œâ”€â”€ service-call.html.template    # æœåŠ¡è°ƒç”¨ HTML æ¨¡æ¿
â”‚   â”œâ”€â”€ topic-pub.js.template         # è¯é¢˜å‘å¸ƒ JS æ¨¡æ¿
â”‚   â”œâ”€â”€ topic-pub.html.template       # è¯é¢˜å‘å¸ƒ HTML æ¨¡æ¿
â”‚   â”œâ”€â”€ topic-sub.js.template         # è¯é¢˜è®¢é˜… JS æ¨¡æ¿
â”‚   â””â”€â”€ topic-sub.html.template       # è¯é¢˜è®¢é˜… HTML æ¨¡æ¿
â”‚
â””â”€â”€ generated/                         # ç”Ÿæˆçš„èŠ‚ç‚¹åŒ…
    â”œâ”€â”€ package.json                  # Node-RED åŒ…é…ç½®
    â”œâ”€â”€ zj-humanoid-nodes.js          # ä¸»å…¥å£æ–‡ä»¶
    â”œâ”€â”€ zj-humanoid-nodes.html        # åˆå¹¶çš„ HTML æ–‡ä»¶
    â”œâ”€â”€ nodes/                        # JS èŠ‚ç‚¹å®ç°
    â”‚   â”œâ”€â”€ dh-service-test-service.js
    â”‚   â”œâ”€â”€ zj-humanoid-manipulation-version-service.js
    â”‚   â””â”€â”€ ... (å…± 170 ä¸ª)
    â””â”€â”€ ui/                           # HTML UI å®šä¹‰
        â”œâ”€â”€ dh-service-test-service.html
        â”œâ”€â”€ zj-humanoid-manipulation-version-service.html
        â””â”€â”€ ... (å…± 170 ä¸ª)
```

---

## ğŸ¯ èŠ‚ç‚¹åˆ†ç±»

ç”Ÿæˆçš„èŠ‚ç‚¹æŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç±»,åœ¨ Node-RED é¢æ¿ä¸­å¯ä»¥åœ¨ç›¸åº”ç±»åˆ«ä¸‹æ‰¾åˆ°:

### æœåŠ¡èŠ‚ç‚¹ç±»åˆ«
- **æµ‹è¯•æ¨¡å—** - æµ‹è¯•ç›¸å…³æœåŠ¡
- **æ“ä½œæ¨¡å—** - æœºå™¨äººæ“ä½œç›¸å…³æœåŠ¡
- **å¯¼èˆªæ¨¡å—** - å®šä½å¯¼èˆªæœåŠ¡
- **ä¼ æ„Ÿå™¨æ¨¡å—** - ä¼ æ„Ÿå™¨æ•°æ®æœåŠ¡
- **æœºå™¨äººçŠ¶æ€** - çŠ¶æ€æŸ¥è¯¢ä¸æ§åˆ¶æœåŠ¡
- **æ‰‹éƒ¨æ¨¡å—** - çµå·§æ‰‹æ§åˆ¶æœåŠ¡
- **è¯­éŸ³æ¨¡å—** - è¯­éŸ³äº¤äº’æœåŠ¡
- **ä¸‹è‚¢æ¨¡å—** - ä¸‹è‚¢è¿åŠ¨æ§åˆ¶æœåŠ¡
- **ä¸Šè‚¢æ¨¡å—** - ä¸Šè‚¢è¿åŠ¨æ§åˆ¶æœåŠ¡

### è¯é¢˜èŠ‚ç‚¹ç±»åˆ«
åŒä¸Šåˆ†ç±»,å¦æœ‰ `pub` å’Œ `sub` åç¼€åŒºåˆ†å‘å¸ƒ/è®¢é˜…èŠ‚ç‚¹ã€‚

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: è°ƒç”¨æœåŠ¡æŸ¥è¯¢æœºå™¨äººç‰ˆæœ¬

1. ä»å·¦ä¾§é¢æ¿æ‹–æ‹½ **"æ“ä½œæ¨¡å—"** â†’ **"æ“ä½œæ¨¡å—ç‰ˆæœ¬å·"** èŠ‚ç‚¹åˆ°ç”»å¸ƒ
2. æ‹–æ‹½ **inject** èŠ‚ç‚¹ä½œä¸ºè§¦å‘å™¨
3. æ‹–æ‹½ **debug** èŠ‚ç‚¹æŸ¥çœ‹ç»“æœ
4. è¿æ¥: `inject` â†’ `æ“ä½œæ¨¡å—ç‰ˆæœ¬å·` â†’ `debug`
5. åŒå‡» inject èŠ‚ç‚¹,è®¾ç½® `msg.payload` ä¸ºç©ºå¯¹è±¡ `{}`
6. éƒ¨ç½²å¹¶ç‚¹å‡» inject èŠ‚ç‚¹è§¦å‘

### ç¤ºä¾‹ 2: è®¢é˜…æœºå™¨äººå…³èŠ‚çŠ¶æ€

1. ä»å·¦ä¾§é¢æ¿æ‹–æ‹½ **"ä¸Šè‚¢æ¨¡å—"** â†’ **"ä¸Šè‚¢å…³èŠ‚ä½ç½®çŠ¶æ€ (sub)"** èŠ‚ç‚¹
2. æ‹–æ‹½ **debug** èŠ‚ç‚¹
3. è¿æ¥: `ä¸Šè‚¢å…³èŠ‚ä½ç½®çŠ¶æ€` â†’ `debug`
4. éƒ¨ç½²åè‡ªåŠ¨å¼€å§‹è®¢é˜…,åœ¨ debug çª—å£æŸ¥çœ‹å®æ—¶æ•°æ®

### ç¤ºä¾‹ 3: å‘å¸ƒæ§åˆ¶æŒ‡ä»¤

1. ä»å·¦ä¾§é¢æ¿æ‹–æ‹½ **"æ‰‹éƒ¨æ¨¡å—"** â†’ **"å·¦æ‰‹æ‰‹åŠ¿åˆ‡æ¢"** æœåŠ¡èŠ‚ç‚¹
2. æ‹–æ‹½ **inject** èŠ‚ç‚¹
3. æ‹–æ‹½ **function** èŠ‚ç‚¹,ç¼–å†™æ¶ˆæ¯:
   ```javascript
   msg.payload = {
       gesture: "yeah"  // è®¾ç½®æ‰‹åŠ¿
   };
   return msg;
   ```
4. è¿æ¥: `inject` â†’ `function` â†’ `å·¦æ‰‹æ‰‹åŠ¿åˆ‡æ¢`
5. éƒ¨ç½²å¹¶è§¦å‘

---

## ğŸ”§ è‡ªå®šä¹‰èŠ‚ç‚¹

### æ·»åŠ æ–°èŠ‚ç‚¹

1. ç¼–è¾‘ `zj_humanoid_interfaces.json`,æ·»åŠ æ–°çš„æœåŠ¡æˆ–è¯é¢˜å®šä¹‰
2. è¿è¡Œç”Ÿæˆå™¨: `node generator.js`
3. é‡æ–°å®‰è£…åˆ° Node-RED

### ä¿®æ”¹èŠ‚ç‚¹æ¨¡æ¿

æ¨¡æ¿æ–‡ä»¶ä½äº `templates/` ç›®å½•:

- `service-call.*.template` - æœåŠ¡è°ƒç”¨èŠ‚ç‚¹
- `topic-pub.*.template` - è¯é¢˜å‘å¸ƒèŠ‚ç‚¹  
- `topic-sub.*.template` - è¯é¢˜è®¢é˜…èŠ‚ç‚¹

ä¿®æ”¹æ¨¡æ¿åé‡æ–°è¿è¡Œç”Ÿæˆå™¨å³å¯ã€‚

---

## ğŸ“ èŠ‚ç‚¹å‘½åè§„åˆ™

### èŠ‚ç‚¹ç±»å‹å‘½å
- æœåŠ¡èŠ‚ç‚¹: `zj-humanoid-service-[service-name]`
- å‘å¸ƒèŠ‚ç‚¹: `zj-humanoid-pub-[topic-name]`
- è®¢é˜…èŠ‚ç‚¹: `zj-humanoid-sub-[topic-name]`

å…¶ä¸­ `[service-name]` å’Œ `[topic-name]` ç”±åŸå§‹åç§°è½¬æ¢è€Œæ¥:
- ç§»é™¤å¼€å¤´çš„ `/`
- å°† `/` æ›¿æ¢ä¸º `-`
- è½¬æ¢ä¸ºå°å†™

ç¤ºä¾‹:
- `/zj_humanoid/manipulation/version` â†’ `zj-humanoid-service-zj-humanoid-manipulation-version`

---

## ğŸ› ï¸ ä¾èµ–é¡¹

- **Node-RED**: >= 1.0.0
- **roslib**: ^1.1.0 (ROS JavaScript åº“)

---

## â“ å¸¸è§é—®é¢˜

### Q1: èŠ‚ç‚¹æ²¡æœ‰å‡ºç°åœ¨é¢æ¿ä¸­?
**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹:
1. ç¡®è®¤å·²é‡å¯ Node-RED
2. æ£€æŸ¥ç»ˆç«¯æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. éªŒè¯ package.json æ ¼å¼æ­£ç¡®
4. ç¡®è®¤ `~/.node-red/node_modules` ä¸­å­˜åœ¨è¯¥åŒ…

### Q2: è¿æ¥ä¸ä¸Š ROS?
**A:** 
1. ç¡®ä¿ ROS Bridge å·²å¯åŠ¨: `roslaunch rosbridge_server rosbridge_websocket.launch`
2. æ£€æŸ¥ ROS Server é…ç½®èŠ‚ç‚¹çš„ URL (é»˜è®¤ `ws://localhost:9090`)
3. éªŒè¯ç½‘ç»œè¿æ¥

### Q3: å¦‚ä½•æ›´æ–°èŠ‚ç‚¹?
**A:**
1. ä¿®æ”¹ `zj_humanoid_interfaces.json`
2. é‡æ–°è¿è¡Œ `node generator.js`
3. åœ¨ Node-RED ç›®å½•æ‰§è¡Œ `npm update node-red-contrib-zj-humanoid-nodes`
4. é‡å¯ Node-RED

### Q4: èŠ‚ç‚¹å¤ªå¤š,å¦‚ä½•ç­›é€‰?
**A:**
- ä½¿ç”¨ Node-RED å·¦ä¾§é¢æ¿çš„æœç´¢æ¡†
- æŒ‰ç±»åˆ«æµè§ˆ (èŠ‚ç‚¹å·²æŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç±»)
- å¯ä»¥ä¿®æ”¹ `zj_humanoid_interfaces.json` åªç”Ÿæˆéœ€è¦çš„èŠ‚ç‚¹

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®åŸºäº [node-red-contrib-flowake-ros-nodes](https://gitlab.com/flowake/node-red-ros-nodes) çš„è®¾è®¡æ¨¡å¼å¼€å‘ã€‚

---

## ğŸ“§ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®,è¯·æäº¤ Issue æˆ– Pull Requestã€‚

**ç¥ä½¿ç”¨æ„‰å¿«!** ğŸ‰
